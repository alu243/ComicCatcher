@using ComicCatcherLib.Utils
@model ComicApi.Model.PageModel

@{
    ViewBag.Title = "Pagination";
    Layout = "_Layout";
}

<h2 style="display: inline-block;">@Model.CurrPagination.Caption</h2>
<button onclick="location.href='/page/@Model.CurrPagination.TabNumber/true'">顯示全部</button>
<button onclick="location.href='/page/@Model.CurrPagination.TabNumber'">隱藏</button>
<br />
@{

    int i = 0;
    foreach (var p in Model.Paginations)
    {
        var pg = ++i;
        if (pg < Model.CurrPagination.TabNumber - 2 || pg > Model.CurrPagination.TabNumber + 2) continue;
        if (pg == Model.CurrPagination.TabNumber)
        {
            <b>@p.Caption</b>
        }
        else
        {
            <a href=@pg>@p.Caption</a>
        }
    }

    var pageCount = 5;
    i = 0;
    @Html.Raw("<table style='max-width: 1000px;'><tbody>")

    foreach (var comic in Model.ShowComics)
    {
        var isIgnore = Model.IgnoreComics.ContainsKey(comic.Url.GetUrlDirectoryName());
        var isFavorite = Model.FavoriteComics.ContainsKey(comic.Url.GetUrlDirectoryName());
        if (i % pageCount == 0)
        {
            @Html.Raw("<tr>")
        }
        <td>
            <p>
                <a href="../comic/@comic.Url.GetUrlDirectoryName()" target="_comic">
                    <img src=@comic.IconUrl><br>
                    @if (isFavorite)
                    {
                        <span style="color:blue;font-weight: 900; padding-top:3px; padding-bottom:3px">@comic.Caption</span>
                    }
                    else
                    {
                        <span style="color:black; padding-top:3px; padding-bottom:3px">@comic.Caption</span>
                    }
                </a>

                <br />

                @if (isIgnore)
                {
                    <button style="font-size: 16px;" onclick="deleteIgnoreComic('@comic.Url.GetUrlDirectoryName()')">顯示</button>
                }
                else
                {
                    <button style="font-size: 16px;" onclick="addIgnoreComic('@comic.Url.GetUrlDirectoryName()', '@comic.Caption')">隱藏</button>
                }

                &nbsp;&nbsp;&nbsp;

                @if (isFavorite)
                {
                    <button style="font-size: 16px;" onclick="deleteFavoriteComic('@comic.Url.GetUrlDirectoryName()')">移除最愛</button>
                }
                else
                {
                    <button style="font-size: 16px;" onclick="addFavoriteComic('@comic.Url.GetUrlDirectoryName()', '@comic.Caption', '@comic.IconUrl')">加入最愛</button>
                }
            </p>
        </td>
        i++;
        if (i % pageCount == 0)
        {
            @Html.Raw("</tr>")
        }
    }
    if (i % pageCount != 0) Html.Raw("</tr>");
    @Html.Raw("</tbody></table>")
    ;
}
